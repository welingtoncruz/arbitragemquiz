<dom-module id="quiz-question">
  <style is="custom-style">
    paper-radio-button {
      display: block;
      margin-left: 10px;
    }

    .question {
      height: 100%;
      background-color: #F5F5F5;
      color: #333;
      width: 99%;
      margin-left: 3px;
    }

    .description {
      font-size: 14px;
      width: 95%;
      margin: auto;
    }

    .content {
      margin: 5px 0px auto;
      height: 100%;
      font-size: 12px;
    }

    .count {
      width: 78%;
      text-align: center;
      margin: auto;
      font-size: 30px;
      border-radius: 50px;
      overflow: hidden;
    }

    .top {
      margin: auto;
      width: 100%;
      overflow: hidden;
    }

  </style>
  <template>
      <div class="question">
        <span class="description">{{question.DESCRICAO}}</span>
      </div>
      <div class="content">
        <paper-radio-group>
          <template is="dom-repeat" items="{{alternatives}}">
            <paper-radio-button name="{{item.ID}}">{{item.DESCRICAO}}</paper-radio-button>
          </template>
        </paper-radio-group>
      </div>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'quiz-question',
        properties: {
          question: {
            type: Object
          },
          alternatives: {
            type: Array,
            value: function() {
              return [];
            }
          }
        },

        ready: function() {

          var seed = (Math.random() + 1) * 1111111;
          var db = openDatabase('quizFifaApp', '1.0', 'quizFifaApp', 10000000);
          var whereQuestion = 'where PERGUNTA_ID = '+ this.question.ID;
          var select = 'SELECT * FROM ALTERNATIVA ' +whereQuestion+' ORDER BY ROWID * ? % 10000;';
          db.transaction(
            $.proxy(function (transaction) {
              transaction.executeSql(select,
                [seed],
                $.proxy(this.dataHandler, this),
                $.proxy(this.errorHandler, this));
            }, this)
          );
        },

        dataHandler: function (tx, results) {
          var alternatives = [];
          for (var i=0; i<results.rows.length; i++) {
            var alternativa = results.rows.item(i);
            alternatives.push(alternativa);
          }
          this.alternatives = alternatives;
        },

        errorHandler: function (transaction, error) {
          console.log('Oops.  Error was '+error.message+' (Code '+error.code+')');
          var we_think_this_error_is_fatal = true;
          if (we_think_this_error_is_fatal) { return true; }
          return false;
        }
      });
    })();
  </script>

</dom-module>
